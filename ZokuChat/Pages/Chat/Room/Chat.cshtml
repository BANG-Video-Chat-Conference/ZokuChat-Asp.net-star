@page
@model ChatModel
@{
	ViewData["Title"] = "Chat";
}

@using ZokuChat.Helpers
@using ZokuChat.Models
@using ZokuChat.Services
@inject Context Context
@inject IUserService UserService

<div id="chat-app" class="chat-container">
	<div class="chat-header">
		<a class="float-left" href="@UrlHelper.GetEnterRoomUrl(Model.Room.Id)">@Model.Room.Name</a>
		<a class="float-right" href="@UrlHelper.GetRoomsUrl()">Exit Room</a>
	</div>
	<div class="chat-content">
		<div id="messages-container" class="chat-messages">
			<div v-for="message in messages">
				<span :class="{ 'text-creator' : window.ZokuChat.chat.room.creatorId == message.userId, 'text-contact' : window.ZokuChat.chat.room.creatorId != message.userId }">
					{{ message.userName }}:
				</span>
				<span v-if="!message.isDeleted">
					{{ ` ${message.text}` }}
				</span>
				<span v-if="message.isDeleted"
						class="text-error"
						:title="`Deleted by ${message.modifiedUserName}`">
					{{ ' [ deleted ]' }}
				</span>
				<div class="action-menu text-creator"
					 @@mouseover="message.showActionMenu = true"
					 @@mouseout="message.showActionMenu = false"
					 v-if="!message.isDeleted && canDeleteMessage(message)">
					<span>
						<b class="action-menu-button">+</b>
					</span>
					<div v-if="message.showActionMenu" class="action-menu-options">
						<span class="action-menu-button"
							  @@click="deleteMessage(message); message.showActionMenu = false;">
							Delete
						</span>
					</div>
				</div>
			</div>
		</div>
		<div class="chat-sidebar">
			<div class="text-creator">
				@UserService.GetUserNameByUID(Model.Room.CreatedUID)
			</div>
			<div v-for="contact in contacts">
				<div class="text-contact">
					{{ contact.userName }}
				</div>
			</div>
		</div>
	</div>
	<div class="chat-footer">
		<div class="input-group">
			<input id="message-input" 
				   pattern=".{1,2000}"
				   placeholder="Enter a message"
				   class="form-control"
				   @@keydown.enter="sendButtonClick();"
				   required />
			<div class="input-group-append">
				<input id="send-message" class="btn btn-primary" @@click="sendButtonClick();" required type="submit" value="Send" />
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<partial name="_ChatScriptsPartial" />
	<script>
		window.ZokuChat.chat.room = new Room(@Model.Room.Id, '@Model.Room.CreatedUID', '@Context.CurrentUser.Id');
		app.init();
	</script>
}