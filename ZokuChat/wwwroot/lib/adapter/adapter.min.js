(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.adapter=n()}})(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";function s(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function e(n,t,r,u,f){var e=i.writeRtpDescription(n.kind,t),s,o;return e+=i.writeIceParameters(n.iceGatherer.getLocalParameters()),e+=i.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":f||"active"),e+="a=mid:"+n.mid+"\r\n",e+=n.rtpSender&&n.rtpReceiver?"a=sendrecv\r\n":n.rtpSender?"a=sendonly\r\n":n.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",n.rtpSender&&(s=n.rtpSender._initialTrackId||n.rtpSender.track.id,n.rtpSender._initialTrackId=s,o="msid:"+(u?u.id:"-")+" "+s+"\r\n",e+="a="+o,e+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+o,n.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+o,e+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+"\r\n")),e+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",n.rtpSender&&n.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),e}function h(n,t){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(n){var r,u;if(n&&(n.urls||n.url))return r=n.urls||n.url,n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead."),u=typeof r=="string",u&&(r=[r]),r=r.filter(function(n){var r=n.indexOf("turn:")===0&&n.indexOf("transport=udp")!==-1&&n.indexOf("turn:[")===-1&&!i;return r?(i=!0,!0):n.indexOf("stun:")===0&&t>=14393&&n.indexOf("?transport=udp")===-1}),delete n.url,n.urls=u?r[0]:r,!!r.length})}function u(n,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(n,t){n=parseInt(n,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===n||t[i].preferredPayloadType===n)return t[i]},u=function(n,t,i,u){var f=r(n.parameters.apt,i),e=r(t.parameters.apt,u);return f&&e&&f.name.toLowerCase()===e.name.toLowerCase()};return n.codecs.forEach(function(r){for(var f,e=0;e<t.codecs.length;e++)if(f=t.codecs[e],r.name.toLowerCase()===f.name.toLowerCase()&&r.clockRate===f.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&f.parameters.apt&&!u(r,f,n.codecs,t.codecs))continue;f=JSON.parse(JSON.stringify(f));f.numChannels=Math.min(r.numChannels,f.numChannels);i.codecs.push(f);f.rtcpFeedback=f.rtcpFeedback.filter(function(n){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===n.type&&r.rtcpFeedback[t].parameter===n.parameter)return!0;return!1});break}}),n.headerExtensions.forEach(function(n){for(var u,r=0;r<t.headerExtensions.length;r++)if(u=t.headerExtensions[r],n.uri===u.uri){i.headerExtensions.push(u);break}}),i}function o(n,t,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(i)!==-1}function f(n,t){var i=n.getRemoteCandidates().find(function(n){return t.foundation===n.foundation&&t.ip===n.ip&&t.port===n.port&&t.priority===n.priority&&t.protocol===n.protocol&&t.type===n.type});return i||n.addRemoteCandidate(t),!i}function r(n,t){var i=new Error(t);return i.name=n,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[n],i}var i=n("sdp");t.exports=function(n,t){function a(t,i){i.addTrack(t);i.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:t}))}function p(t,i){i.removeTrack(t);i.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:t}))}function v(t,i,r,u){var f=new Event("track");f.track=i;f.receiver=r;f.transceiver={receiver:r};f.streams=u;n.setTimeout(function(){t._dispatchEvent("track",f)})}var c=function(u){var o=this,e=document.createDocumentFragment(),f;if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(n){o[n]=e[n].bind(e)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",u=JSON.parse(JSON.stringify(u||{})),this.usingBundle=u.bundlePolicy==="max-bundle",u.rtcpMuxPolicy==="negotiate")throw r("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");else u.rtcpMuxPolicy||(u.rtcpMuxPolicy="require");switch(u.iceTransportPolicy){case"all":case"relay":break;default:u.iceTransportPolicy="all"}switch(u.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:u.bundlePolicy="balanced"}if(u.iceServers=h(u.iceServers||[],t),this._iceGatherers=[],u.iceCandidatePoolSize)for(f=u.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:u.iceServers,gatherPolicy:u.iceTransportPolicy}));else u.iceCandidatePoolSize=0;this._config=u;this.transceivers=[];this._sdpSessionId=i.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined;this._isClosed=!1},y,l;return Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(n,t){this._isClosed||(this.dispatchEvent(t),typeof this["on"+n]=="function"&&this["on"+n](t))},c.prototype._emitGatheringStateChange=function(){var n=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",n)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(n,t){var u=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:n,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},r;return this.usingBundle&&u?(i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport):(r=this._createIceAndDtlsTransports(),i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport),t||this.transceivers.push(i),i},c.prototype.addTrack=function(t,i){var e,u,f;if(this._isClosed)throw r("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(e=this.transceivers.find(function(n){return n.track===t}),e)throw r("InvalidAccessError","Track already exists.");for(f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==t.kind||(u=this.transceivers[f]);return u||(u=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(i)===-1&&this.localStreams.push(i),u.track=t,u.stream=i,u.rtpSender=new n.RTCRtpSender(t,u.dtlsTransport),u.rtpSender},c.prototype.addStream=function(n){var r=this,i;t>=15025?n.getTracks().forEach(function(t){r.addTrack(t,n)}):(i=n.clone(),n.getTracks().forEach(function(n,t){var r=i.getTracks()[t];n.addEventListener("enabled",function(n){r.enabled=n.enabled})}),i.getTracks().forEach(function(n){r.addTrack(n,i)}))},c.prototype.removeTrack=function(t){var i,u,f;if(this._isClosed)throw r("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");if(i=this.transceivers.find(function(n){return n.rtpSender===t}),!i)throw r("InvalidAccessError","Sender was not created by this connection.");u=i.stream;i.rtpSender.stop();i.rtpSender=null;i.track=null;i.stream=null;f=this.transceivers.map(function(n){return n.stream});f.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1);this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(n){var t=this;n.getTracks().forEach(function(n){var i=t.getSenders().find(function(t){return t.track===n});i&&t.removeTrack(i)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(n){return!!n.rtpSender}).map(function(n){return n.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(n){return!!n.rtpReceiver}).map(function(n){return n.rtpReceiver})},c.prototype._createIceGatherer=function(t,i){var u=this,r;return i&&t>0?this.transceivers[0].iceGatherer:this._iceGatherers.length?this._iceGatherers.shift():(r=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy}),Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(n){var i=!n.candidate||Object.keys(n.candidate).length===0;r.state=i?"completed":"gathering";u.transceivers[t].bufferedCandidateEvents!==null&&u.transceivers[t].bufferedCandidateEvents.push(n)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r)},c.prototype._gather=function(t,r){var u=this,f=this.transceivers[r].iceGatherer,e;f.onlocalcandidate||(e=this.transceivers[r].bufferedCandidateEvents,this.transceivers[r].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),f.onlocalcandidate=function(n){var e,o,s,h,c,l;u.usingBundle&&r>0||(e=new Event("icecandidate"),e.candidate={sdpMid:t,sdpMLineIndex:r},o=n.candidate,s=!o||Object.keys(o).length===0,s?(f.state==="new"||f.state==="gathering")&&(f.state="completed"):(f.state==="new"&&(f.state="gathering"),o.component=1,o.ufrag=f.getLocalParameters().usernameFragment,h=i.writeCandidate(o),e.candidate=Object.assign(e.candidate,i.parseCandidate(h)),e.candidate.candidate=h,e.candidate.toJSON=function(){return{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex,usernameFragment:e.candidate.usernameFragment}}),c=i.getMediaSections(u._localDescription.sdp),c[e.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+e.candidate.candidate+"\r\n",u._localDescription.sdp=i.getDescription(u._localDescription.sdp)+c.join(""),l=u.transceivers.every(function(n){return n.iceGatherer&&n.iceGatherer.state==="completed"}),u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),s||u._dispatchEvent("icecandidate",e),l&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange()))},n.setTimeout(function(){e.forEach(function(n){f.onlocalcandidate(n)})},0))},c.prototype._createIceAndDtlsTransports=function(){var i=this,r=new n.RTCIceTransport(null),t;return r.onicestatechange=function(){i._updateIceConnectionState();i._updateConnectionState()},t=new n.RTCDtlsTransport(r),t.ondtlsstatechange=function(){i._updateConnectionState()},t.onerror=function(){Object.defineProperty(t,"state",{value:"failed",writable:!0});i._updateConnectionState()},{iceTransport:r,dtlsTransport:t}},c.prototype._disposeIceAndDtlsTransports=function(n){var r=this.transceivers[n].iceGatherer,i,t;r&&(delete r.onlocalcandidate,delete this.transceivers[n].iceGatherer);i=this.transceivers[n].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[n].iceTransport);t=this.transceivers[n].dtlsTransport;t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[n].dtlsTransport)},c.prototype._transceive=function(n,r,f){var e=u(n.localCapabilities,n.remoteCapabilities);r&&n.rtpSender&&(e.encodings=n.sendEncodingParameters,e.rtcp={cname:i.localCName,compound:n.rtcpParameters.compound},n.recvEncodingParameters.length&&(e.rtcp.ssrc=n.recvEncodingParameters[0].ssrc),n.rtpSender.send(e));f&&n.rtpReceiver&&e.codecs.length>0&&(n.kind==="video"&&n.recvEncodingParameters&&t<15019&&n.recvEncodingParameters.forEach(function(n){delete n.rtx}),e.encodings=n.recvEncodingParameters.length?n.recvEncodingParameters:[{}],e.rtcp={compound:n.rtcpParameters.compound},n.rtcpParameters.cname&&(e.rtcp.cname=n.rtcpParameters.cname),n.sendEncodingParameters.length&&(e.rtcp.ssrc=n.sendEncodingParameters[0].ssrc),n.rtpReceiver.receive(e))},c.prototype.setLocalDescription=function(n){var t=this,f,e,s;return["offer","answer"].indexOf(n.type)===-1?Promise.reject(r("TypeError",'Unsupported type "'+n.type+'"')):!o("setLocalDescription",n.type,t.signalingState)||t._isClosed?Promise.reject(r("InvalidStateError","Can not set local "+n.type+" in state "+t.signalingState)):(n.type==="offer"?(f=i.splitSections(n.sdp),e=f.shift(),f.forEach(function(n,r){var u=i.parseRtpParameters(n);t.transceivers[r].localCapabilities=u}),t.transceivers.forEach(function(n,i){t._gather(n.mid,i)})):n.type==="answer"&&(f=i.splitSections(t._remoteDescription.sdp),e=f.shift(),s=i.matchPrefix(e,"a=ice-lite").length>0,f.forEach(function(n,r){var f=t.transceivers[r],v=f.iceGatherer,h=f.iceTransport,c=f.dtlsTransport,y=f.localCapabilities,p=f.remoteCapabilities,w=i.isRejected(n)&&i.matchPrefix(n,"a=bundle-only").length===0,l,o,a;w||f.rejected||(l=i.getIceParameters(n,e),o=i.getDtlsParameters(n,e),s&&(o.role="server"),t.usingBundle&&r!==0||(t._gather(f.mid,r),h.state==="new"&&h.start(v,l,s?"controlling":"controlled"),c.state==="new"&&c.start(o)),a=u(y,p),t._transceive(f,a.codecs.length>0,!1))})),t._localDescription={type:n.type,sdp:n.sdp},n.type==="offer"?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve())},c.prototype.setRemoteDescription=function(u){var e=this,s,y;if(["offer","answer"].indexOf(u.type)===-1)return Promise.reject(r("TypeError",'Unsupported type "'+u.type+'"'));if(!o("setRemoteDescription",u.type,e.signalingState)||e._isClosed)return Promise.reject(r("InvalidStateError","Can not set remote "+u.type+" in state "+e.signalingState));s={};e.remoteStreams.forEach(function(n){s[n.id]=n});var l=[],w=i.splitSections(u.sdp),h=w.shift(),b=i.matchPrefix(h,"a=ice-lite").length>0,c=i.matchPrefix(h,"a=group:BUNDLE ").length>0;return e.usingBundle=c,y=i.matchPrefix(h,"a=ice-options:")[0],e.canTrickleIceCandidates=y?y.substr(14).split(" ").indexOf("trickle")>=0:!1,w.forEach(function(r,o){var bt=i.splitLines(r),g=i.getKind(r),nt=i.isRejected(r)&&i.matchPrefix(r,"a=bundle-only").length===0,et=bt[0].substr(2).split(" ")[2],d=i.getDirection(r,h),y=i.parseMsid(r),at=i.getMid(r)||i.generateIdentifier(),v,vt,rt,ot,w,st,ht,ut,k,ct,yt,lt,ft,it;if(nt||g==="application"&&(et==="DTLS/SCTP"||et==="UDP/DTLS/SCTP")){e.transceivers[o]={mid:at,kind:g,protocol:et,rejected:!0};return}!nt&&e.transceivers[o]&&e.transceivers[o].rejected&&(e.transceivers[o]=e._createTransceiver(g,!0));ct=i.parseRtpParameters(r);nt||(yt=i.getIceParameters(r,h),lt=i.getDtlsParameters(r,h),lt.role="client");ht=i.parseRtpEncodingParameters(r);var pt=i.parseRtcpParameters(r),wt=i.matchPrefix(r,"a=end-of-candidates",h).length>0,tt=i.matchPrefix(r,"a=candidate:").map(function(n){return i.parseCandidate(n)}).filter(function(n){return n.component===1});(u.type==="offer"||u.type==="answer")&&!nt&&c&&o>0&&e.transceivers[o]&&(e._disposeIceAndDtlsTransports(o),e.transceivers[o].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[o].iceTransport=e.transceivers[0].iceTransport,e.transceivers[o].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[o].rtpSender&&e.transceivers[o].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[o].rtpReceiver&&e.transceivers[o].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport));u.type!=="offer"||nt?u.type!=="answer"||nt||(v=e.transceivers[o],vt=v.iceGatherer,rt=v.iceTransport,ot=v.dtlsTransport,w=v.rtpReceiver,st=v.sendEncodingParameters,ut=v.localCapabilities,e.transceivers[o].recvEncodingParameters=ht,e.transceivers[o].remoteCapabilities=ct,e.transceivers[o].rtcpParameters=pt,tt.length&&rt.state==="new"&&((b||wt)&&(!c||o===0)?rt.setRemoteCandidates(tt):tt.forEach(function(n){f(v.iceTransport,n)})),c&&o!==0||(rt.state==="new"&&rt.start(vt,yt,"controlling"),ot.state==="new"&&ot.start(lt)),e._transceive(v,d==="sendrecv"||d==="recvonly",d==="sendrecv"||d==="sendonly"),w&&(d==="sendrecv"||d==="sendonly")?(k=w.track,y?(s[y.stream]||(s[y.stream]=new n.MediaStream),a(k,s[y.stream]),l.push([k,w,s[y.stream]])):(s.default||(s.default=new n.MediaStream),a(k,s.default),l.push([k,w,s.default]))):delete v.rtpReceiver):(v=e.transceivers[o]||e._createTransceiver(g),v.mid=at,v.iceGatherer||(v.iceGatherer=e._createIceGatherer(o,c)),tt.length&&v.iceTransport.state==="new"&&(wt&&(!c||o===0)?v.iceTransport.setRemoteCandidates(tt):tt.forEach(function(n){f(v.iceTransport,n)})),ut=n.RTCRtpReceiver.getCapabilities(g),t<15019&&(ut.codecs=ut.codecs.filter(function(n){return n.name!=="rtx"})),st=v.sendEncodingParameters||[{ssrc:(2*o+2)*1001}],ft=!1,d==="sendrecv"||d==="sendonly"?(ft=!v.rtpReceiver,w=v.rtpReceiver||new n.RTCRtpReceiver(v.dtlsTransport,g),ft&&(k=w.track,y&&y.stream==="-"||(y?(s[y.stream]||(s[y.stream]=new n.MediaStream,Object.defineProperty(s[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(k,"id",{get:function(){return y.track}}),it=s[y.stream]):(s.default||(s.default=new n.MediaStream),it=s.default)),it&&(a(k,it),v.associatedRemoteMediaStreams.push(it)),l.push([k,w,it]))):v.rtpReceiver&&v.rtpReceiver.track&&(v.associatedRemoteMediaStreams.forEach(function(n){var t=n.getTracks().find(function(n){return n.id===v.rtpReceiver.track.id});t&&p(t,n)}),v.associatedRemoteMediaStreams=[]),v.localCapabilities=ut,v.remoteCapabilities=ct,v.rtpReceiver=w,v.rtcpParameters=pt,v.sendEncodingParameters=st,v.recvEncodingParameters=ht,e._transceive(e.transceivers[o],!1,ft))}),e._dtlsRole===undefined&&(e._dtlsRole=u.type==="offer"?"active":"passive"),e._remoteDescription={type:u.type,sdp:u.sdp},u.type==="offer"?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(s).forEach(function(t){var i=s[t],r;i.getTracks().length&&(e.remoteStreams.indexOf(i)===-1&&(e.remoteStreams.push(i),r=new Event("addstream"),r.stream=i,n.setTimeout(function(){e._dispatchEvent("addstream",r)})),l.forEach(function(n){var t=n[0],r=n[1];i.id===n[2].id&&v(e,t,r,[i])}))}),l.forEach(function(n){n[2]||v(e,n[0],n[1],[])}),n.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.state==="new"&&n.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),n.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.stop();n.dtlsTransport&&n.dtlsTransport.stop();n.rtpSender&&n.rtpSender.stop();n.rtpReceiver&&n.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(n){this.signalingState=n;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},c.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,n.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var n=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",n)}},0))},c.prototype._updateIceConnectionState=function(){var n,t={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0},i;this.transceivers.forEach(function(n){t[n.iceTransport.state]++});n="new";t.failed>0?n="failed":t.checking>0?n="checking":t.disconnected>0?n="disconnected":t.new>0?n="new":t.connected>0?n="connected":t.completed>0&&(n="completed");n!==this.iceConnectionState&&(this.iceConnectionState=n,i=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",i))},c.prototype._updateConnectionState=function(){var t,n={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0},i;this.transceivers.forEach(function(t){n[t.iceTransport.state]++;n[t.dtlsTransport.state]++});n.connected+=n.completed;t="new";n.failed>0?t="failed":n.connecting>0?t="connecting":n.disconnected>0?t="disconnected":n.new>0?t="new":n.connected>0&&(t="connected");t!==this.connectionState&&(this.connectionState=t,i=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",i))},c.prototype.createOffer=function(){var u=this,o,c;if(u._isClosed)return Promise.reject(r("InvalidStateError","Can not call createOffer after close"));var s=u.transceivers.filter(function(n){return n.kind==="audio"}).length,h=u.transceivers.filter(function(n){return n.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==undefined&&(s=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio);f.offerToReceiveVideo!==undefined&&(h=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(u.transceivers.forEach(function(n){n.kind==="audio"?(s--,s<0&&(n.wantReceive=!1)):n.kind==="video"&&(h--,h<0&&(n.wantReceive=!1))});s>0||h>0;)s>0&&(u._createTransceiver("audio"),s--),h>0&&(u._createTransceiver("video"),h--);return o=i.writeSessionBoilerplate(u._sdpSessionId,u._sdpSessionVersion++),u.transceivers.forEach(function(r,f){var h=r.track,s=r.kind,c=r.mid||i.generateIdentifier(),e,o;r.mid=c;r.iceGatherer||(r.iceGatherer=u._createIceGatherer(f,u.usingBundle));e=n.RTCRtpSender.getCapabilities(s);t<15019&&(e.codecs=e.codecs.filter(function(n){return n.name!=="rtx"}));e.codecs.forEach(function(n){n.name==="H264"&&n.parameters["level-asymmetry-allowed"]===undefined&&(n.parameters["level-asymmetry-allowed"]="1");r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate&&(n.preferredPayloadType=t.payloadType)})});e.headerExtensions.forEach(function(n){var t=r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[];t.forEach(function(t){n.uri===t.uri&&(n.id=t.id)})});o=r.sendEncodingParameters||[{ssrc:(2*f+1)*1001}];h&&t>=15019&&s==="video"&&!o[0].rtx&&(o[0].rtx={ssrc:o[0].ssrc+1});r.wantReceive&&(r.rtpReceiver=new n.RTCRtpReceiver(r.dtlsTransport,s));r.localCapabilities=e;r.sendEncodingParameters=o}),u._config.bundlePolicy!=="max-compat"&&(o+="a=group:BUNDLE "+u.transceivers.map(function(n){return n.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",u.transceivers.forEach(function(n,t){o+=e(n,n.localCapabilities,"offer",n.stream,u._dtlsRole);o+="a=rtcp-rsize\r\n";n.iceGatherer&&u.iceGatheringState!=="new"&&(t===0||!u.usingBundle)&&(n.iceGatherer.getLocalCandidates().forEach(function(n){n.component=1;o+="a="+i.writeCandidate(n)+"\r\n"}),n.iceGatherer.state==="completed"&&(o+="a=end-of-candidates\r\n"))}),c=new n.RTCSessionDescription({type:"offer",sdp:o}),Promise.resolve(c)},c.prototype.createAnswer=function(){var f=this,o,s,h;return f._isClosed?Promise.reject(r("InvalidStateError","Can not call createAnswer after close")):(f.signalingState==="have-remote-offer"||f.signalingState==="have-local-pranswer")?(o=i.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++),f.usingBundle&&(o+="a=group:BUNDLE "+f.transceivers.map(function(n){return n.mid}).join(" ")+"\r\n"),s=i.getMediaSections(f._remoteDescription.sdp).length,f.transceivers.forEach(function(n,i){var r,h,c;if(!(i+1>s)){if(n.rejected){n.kind==="application"?o+=n.protocol==="DTLS/SCTP"?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+n.protocol+" webrtc-datachannel\r\n":n.kind==="audio"?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":n.kind==="video"&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n");o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+n.mid+"\r\n";return}n.stream&&(n.kind==="audio"?r=n.stream.getAudioTracks()[0]:n.kind==="video"&&(r=n.stream.getVideoTracks()[0]),r&&t>=15019&&n.kind==="video"&&!n.sendEncodingParameters[0].rtx&&(n.sendEncodingParameters[0].rtx={ssrc:n.sendEncodingParameters[0].ssrc+1}));h=u(n.localCapabilities,n.remoteCapabilities);c=h.codecs.filter(function(n){return n.name.toLowerCase()==="rtx"}).length;!c&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx;o+=e(n,h,"answer",n.stream,f._dtlsRole);n.rtcpParameters&&n.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}),h=new n.RTCSessionDescription({type:"answer",sdp:o}),Promise.resolve(h)):Promise.reject(r("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState))},c.prototype.addIceCandidate=function(n){var t=this,u;return n&&!(n.sdpMLineIndex!==undefined||n.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,o){var h,c,l,a,s,v;if(t._remoteDescription){if(n&&n.candidate!==""){if(c=n.sdpMLineIndex,n.sdpMid)for(l=0;l<t.transceivers.length;l++)if(t.transceivers[l].mid===n.sdpMid){c=l;break}if(a=t.transceivers[c],a){if(a.rejected||(s=Object.keys(n.candidate).length>0?i.parseCandidate(n.candidate):{},s.protocol==="tcp"&&(s.port===0||s.port===9))||s.component&&s.component!==1)return e();if((c===0||c>0&&a.iceTransport!==t.transceivers[0].iceTransport)&&!f(a.iceTransport,s))return o(r("OperationError","Can not add ICE candidate"));v=n.candidate.trim();v.indexOf("a=")===0&&(v=v.substr(2));u=i.getMediaSections(t._remoteDescription.sdp);u[c]+="a="+(s.type?v:"end-of-candidates")+"\r\n";t._remoteDescription.sdp=i.getDescription(t._remoteDescription.sdp)+u.join("")}else return o(r("OperationError","Can not add ICE candidate"))}else for(h=0;h<t.transceivers.length;h++)if(!t.transceivers[h].rejected&&(t.transceivers[h].iceTransport.addRemoteCandidate({}),u=i.getMediaSections(t._remoteDescription.sdp),u[h]+="a=end-of-candidates\r\n",t._remoteDescription.sdp=i.getDescription(t._remoteDescription.sdp)+u.join(""),t.usingBundle))break}else return o(r("InvalidStateError","Can not add ICE candidate without a remote description"));e()})},c.prototype.getStats=function(t){var i,u;if(t&&t instanceof n.MediaStreamTrack){if(i=null,this.transceivers.forEach(function(n){n.rtpSender&&n.rtpSender.track===t?i=n.rtpSender:n.rtpReceiver&&n.rtpReceiver.track===t&&(i=n.rtpReceiver)}),!i)throw r("InvalidAccessError","Invalid selector.");return i.getStats()}return u=[],this.transceivers.forEach(function(n){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){n[t]&&u.push(n[t].getStats())})}),Promise.all(u).then(function(n){var t=new Map;return n.forEach(function(n){n.forEach(function(n){t.set(n.id,n)})}),t})},y=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"],y.forEach(function(t){var i=n[t],r;i&&i.prototype&&i.prototype.getStats&&(r=i.prototype.getStats,i.prototype.getStats=function(){return r.apply(this).then(function(n){var t=new Map;return Object.keys(n).forEach(function(i){n[i].type=s(n[i]);t.set(i,n[i])}),t})})}),l=["createOffer","createAnswer"],l.forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[0]=="function"||typeof n[1]=="function"?t.apply(this,[arguments[2]]).then(function(t){typeof n[0]=="function"&&n[0].apply(null,[t])},function(t){typeof n[1]=="function"&&n[1].apply(null,[t])}):t.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[1]=="function"||typeof n[2]=="function"?t.apply(this,arguments).then(function(){typeof n[1]=="function"&&n[1].apply(null)},function(t){typeof n[2]=="function"&&n[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[1]=="function"?t.apply(this,arguments).then(function(){typeof n[1]=="function"&&n[1].apply(null)}):t.apply(this,arguments)}}),c}},{sdp:2}],2:[function(n,t){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};i.localCName=i.generateIdentifier();i.splitLines=function(n){return n.trim().split("\n").map(function(n){return n.trim()})};i.splitSections=function(n){var t=n.split("\nm=");return t.map(function(n,t){return(t>0?"m="+n:n).trim()+"\r\n"})};i.getDescription=function(n){var t=i.splitSections(n);return t&&t[0]};i.getMediaSections=function(n){var t=i.splitSections(n);return t.shift(),t};i.matchPrefix=function(n,t){return i.splitLines(n).filter(function(n){return n.indexOf(t)===0})};i.parseCandidate=function(n){var t,r,i;for(t=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "),r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1];r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r};i.writeCandidate=function(n){var t=[],i;return t.push(n.foundation),t.push(n.component),t.push(n.protocol.toUpperCase()),t.push(n.priority),t.push(n.ip),t.push(n.port),i=n.type,t.push("typ"),t.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(t.push("raddr"),t.push(n.relatedAddress),t.push("rport"),t.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(t.push("ufrag"),t.push(n.usernameFragment||n.ufrag)),"candidate:"+t.join(" ")};i.parseIceOptions=function(n){return n.substr(14).split(" ")};i.parseRtpMap=function(n){var t=n.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=t.length===3?parseInt(t[2],10):1,i.numChannels=i.channels,i};i.writeRtpMap=function(n){var i=n.payloadType,t;return n.preferredPayloadType!==undefined&&(i=n.preferredPayloadType),t=n.channels||n.numChannels||1,"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(t!==1?"/"+t:"")+"\r\n"};i.parseExtmap=function(n){var t=n.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};i.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+"\r\n"};i.parseFmtp=function(n){for(var r={},t,u=n.substr(n.indexOf(" ")+1).split(";"),i=0;i<u.length;i++)t=u[i].trim().split("="),r[t[0].trim()]=t[1];return r};i.writeFmtp=function(n){var i="",r=n.payloadType,t;return n.preferredPayloadType!==undefined&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length&&(t=[],Object.keys(n.parameters).forEach(function(i){n.parameters[i]?t.push(i+"="+n.parameters[i]):t.push(i)}),i+="a=fmtp:"+r+" "+t.join(";")+"\r\n"),i};i.parseRtcpFb=function(n){var t=n.substr(n.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};i.writeRtcpFb=function(n){var t="",i=n.payloadType;return n.preferredPayloadType!==undefined&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(n){t+="a=rtcp-fb:"+i+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+"\r\n"}),t};i.parseSsrcMedia=function(n){var t=n.indexOf(" "),i={ssrc:parseInt(n.substr(7,t-7),10)},r=n.indexOf(":",t);return r>-1?(i.attribute=n.substr(t+1,r-t-1),i.value=n.substr(r+1)):i.attribute=n.substr(t+1),i};i.parseSsrcGroup=function(n){var t=n.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(n){return parseInt(n,10)})}};i.getMid=function(n){var t=i.matchPrefix(n,"a=mid:")[0];if(t)return t.substr(6)};i.parseFingerprint=function(n){var t=n.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};i.getDtlsParameters=function(n,t){var r=i.matchPrefix(n+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(i.parseFingerprint)}};i.writeDtlsParameters=function(n,t){var i="a=setup:"+t+"\r\n";return n.fingerprints.forEach(function(n){i+="a=fingerprint:"+n.algorithm+" "+n.value+"\r\n"}),i};i.getIceParameters=function(n,t){var r=i.splitLines(n);return r=r.concat(i.splitLines(t)),{usernameFragment:r.filter(function(n){return n.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:r.filter(function(n){return n.indexOf("a=ice-pwd:")===0})[0].substr(10)}};i.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+"\r\na=ice-pwd:"+n.password+"\r\n"};i.parseRtpParameters=function(n){for(var u,e,t,o,r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=i.splitLines(n),s=h[0].split(" "),f=3;f<s.length;f++)if(u=s[f],e=i.matchPrefix(n,"a=rtpmap:"+u+" ")[0],e){t=i.parseRtpMap(e);o=i.matchPrefix(n,"a=fmtp:"+u+" ");t.parameters=o.length?i.parseFmtp(o[0]):{};t.rtcpFeedback=i.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(i.parseRtcpFb);r.codecs.push(t);switch(t.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(t.name.toUpperCase())}}return i.matchPrefix(n,"a=extmap:").forEach(function(n){r.headerExtensions.push(i.parseExtmap(n))}),r};i.writeRtpDescription=function(n,t){var r="",u;return r+="m="+n+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(n){return n.preferredPayloadType!==undefined?n.preferredPayloadType:n.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(n){r+=i.writeRtpMap(n);r+=i.writeFmtp(n);r+=i.writeRtcpFb(n)}),u=0,t.codecs.forEach(function(n){n.maxptime>u&&(u=n.maxptime)}),u>0&&(r+="a=maxptime:"+u+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(n){r+=i.writeExtmap(n)}),r};i.parseRtpEncodingParameters=function(n){var r=[],o=i.parseRtpParameters(n),h=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,s=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"}),u=s.length>0&&s[0].ssrc,f,e=i.matchPrefix(n,"a=ssrc-group:FID").map(function(n){var t=n.substr(17).split(" ");return t.map(function(n){return parseInt(n,10)})}),t;return e.length>0&&e[0].length>1&&e[0][0]===u&&(f=e[0][1]),o.codecs.forEach(function(n){if(n.name.toUpperCase()==="RTX"&&n.parameters.apt){var t={ssrc:u,codecPayloadType:parseInt(n.parameters.apt,10)};u&&f&&(t.rtx={ssrc:f});r.push(t);h&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:f,mechanism:c?"red+ulpfec":"red"},r.push(t))}}),r.length===0&&u&&r.push({ssrc:u}),t=i.matchPrefix(n,"b="),t.length&&(t=t[0].indexOf("b=TIAS:")===0?parseInt(t[0].substr(7),10):t[0].indexOf("b=AS:")===0?parseInt(t[0].substr(5),10)*1e3*.95-16e3:undefined,r.forEach(function(n){n.maxBitrate=t})),r};i.parseRtcpParameters=function(n){var t={},r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"})[0],u,f;return r&&(t.cname=r.value,t.ssrc=r.ssrc),u=i.matchPrefix(n,"a=rtcp-rsize"),t.reducedSize=u.length>0,t.compound=u.length===0,f=i.matchPrefix(n,"a=rtcp-mux"),t.mux=f.length>0,t};i.parseMsid=function(n){var t,u=i.matchPrefix(n,"a=msid:"),r;return u.length===1?(t=u[0].substr(7).split(" "),{stream:t[0],track:t[1]}):(r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="msid"}),r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0)};i.generateSessionId=function(){return Math.random().toString().substr(2,21)};i.writeSessionBoilerplate=function(n,t){var r,u=t!==undefined?t:2;return r=n?n:i.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+u+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};i.writeMediaSection=function(n,t,r,u){var f=i.writeRtpDescription(n.kind,t),e;return f+=i.writeIceParameters(n.iceGatherer.getLocalParameters()),f+=i.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),f+="a=mid:"+n.mid+"\r\n",f+=n.direction?"a="+n.direction+"\r\n":n.rtpSender&&n.rtpReceiver?"a=sendrecv\r\n":n.rtpSender?"a=sendonly\r\n":n.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",n.rtpSender&&(e="msid:"+u.id+" "+n.rtpSender.track.id+"\r\n",f+="a="+e,f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+e,n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+e,f+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+"\r\n")),f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",n.rtpSender&&n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),f};i.getDirection=function(n,t){for(var u=i.splitLines(n),r=0;r<u.length;r++)switch(u[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[r].substr(2)}return t?i.getDirection(t):"sendrecv"};i.getKind=function(n){var t=i.splitLines(n),r=t[0].split(" ");return r[0].substr(2)};i.isRejected=function(n){return n.split(" ",2)[1]==="0"};i.parseMLine=function(n){var r=i.splitLines(n),t=r[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}};i.parseOLine=function(n){var r=i.matchPrefix(n,"o=")[0],t=r.substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}};i.isValidSDP=function(n){var r,t;if(typeof n!="string"||n.length===0)return!1;for(r=i.splitLines(n),t=0;t<r.length;t++)if(r[t].length<2||r[t].charAt(1)!=="=")return!1;return!0};typeof t=="object"&&(t.exports=i)},{}],3:[function(n,t){(function(i){"use strict";var r=n("./adapter_factory.js");t.exports=r({window:i.window})}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./adapter_factory.js":4}],4:[function(n,t){"use strict";var i=n("./utils");t.exports=function(t,r){var u=t&&t.window,a={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var v in r)hasOwnProperty.call(r,v)&&(a[v]=r[v]);var s=i.log,y=i.detectBrowser(u),e=n("./chrome/chrome_shim")||null,l=n("./edge/edge_shim")||null,o=n("./firefox/firefox_shim")||null,h=n("./safari/safari_shim")||null,f=n("./common_shim")||null,c={browserDetails:y,commonShim:f,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings};switch(y.browser){case"chrome":if(!e||!e.shimPeerConnection||!a.shimChrome)return s("Chrome shim is not included in this adapter release."),c;s("adapter.js shimming chrome.");c.browserShim=e;f.shimCreateObjectURL(u);e.shimGetUserMedia(u);e.shimMediaStream(u);e.shimSourceObject(u);e.shimPeerConnection(u);e.shimOnTrack(u);e.shimAddTrackRemoveTrack(u);e.shimGetSendersWithDtmf(u);e.shimSenderReceiverGetStats(u);e.fixNegotiationNeeded(u);f.shimRTCIceCandidate(u);f.shimMaxMessageSize(u);f.shimSendThrowTypeError(u);break;case"firefox":if(!o||!o.shimPeerConnection||!a.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox.");c.browserShim=o;f.shimCreateObjectURL(u);o.shimGetUserMedia(u);o.shimSourceObject(u);o.shimPeerConnection(u);o.shimOnTrack(u);o.shimRemoveStream(u);o.shimSenderGetStats(u);o.shimReceiverGetStats(u);o.shimRTCDataChannel(u);f.shimRTCIceCandidate(u);f.shimMaxMessageSize(u);f.shimSendThrowTypeError(u);break;case"edge":if(!l||!l.shimPeerConnection||!a.shimEdge)return s("MS edge shim is not included in this adapter release."),c;s("adapter.js shimming edge.");c.browserShim=l;f.shimCreateObjectURL(u);l.shimGetUserMedia(u);l.shimPeerConnection(u);l.shimReplaceTrack(u);f.shimMaxMessageSize(u);f.shimSendThrowTypeError(u);break;case"safari":if(!h||!a.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari.");c.browserShim=h;f.shimCreateObjectURL(u);h.shimRTCIceServerUrls(u);h.shimCreateOfferLegacy(u);h.shimCallbacksAPI(u);h.shimLocalStreamsAPI(u);h.shimRemoteStreamsAPI(u);h.shimTrackEventTransceiver(u);h.shimGetUserMedia(u);f.shimRTCIceCandidate(u);f.shimMaxMessageSize(u);f.shimSendThrowTypeError(u);break;default:s("Unsupported browser!")}return c}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(n,t){"use strict";function r(n,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(function(u){u.endsWith("Id")?r(n,n.get(t[u]),i):u.endsWith("Ids")&&t[u].forEach(function(t){r(n,n.get(t),i)})}))}function u(n,t,i){var e=i?"outbound-rtp":"inbound-rtp",u=new Map,f;return t===null?u:(f=[],n.forEach(function(n){n.type==="track"&&n.trackIdentifier===t.id&&f.push(n)}),f.forEach(function(t){n.forEach(function(i){i.type===e&&i.trackId===t.id&&r(n,i,u)})}),u)}var i=n("../utils.js"),f=i.log;t.exports={shimGetUserMedia:n("./getusermedia"),shimMediaStream:function(n){n.MediaStream=n.MediaStream||n.webkitMediaStream},shimOnTrack:function(n){if(typeof n!="object"||!n.RTCPeerConnection||"ontrack"in n.RTCPeerConnection.prototype)"RTCRtpTransceiver"in n||i.wrapPeerConnectionEvent(n,"track",function(n){return n.transceiver||(n.transceiver={receiver:n.receiver}),n});else{Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});var t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return i._ontrackpoly||(i._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var f,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track&&n.track.id===r.track.id}):{track:r.track};u=new Event("track");u.track=r.track;u.receiver=f;u.transceiver={receiver:f};u.streams=[t.stream];i.dispatchEvent(u)});t.stream.getTracks().forEach(function(r){var f,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track&&n.track.id===r.id}):{track:r};u=new Event("track");u.track=r;u.receiver=f;u.transceiver={receiver:f};u.streams=[t.stream];i.dispatchEvent(u)})},i.addEventListener("addstream",i._ontrackpoly)),t.apply(i,arguments)}}},shimGetSendersWithDtmf:function(n){var t,i,r,u,f,e;typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype?(t=function(n,t){return{track:t,get dtmf(){return this._dtmf===undefined&&(this._dtmf=t.kind==="audio"?n.createDTMFSender(t):null),this._dtmf},_pc:n}},n.RTCPeerConnection.prototype.getSenders||(n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=n.RTCPeerConnection.prototype.addTrack,n.RTCPeerConnection.prototype.addTrack=function(n){var u=this,r=i.apply(u,arguments);return r||(r=t(u,n),u._senders.push(r)),r},r=n.RTCPeerConnection.prototype.removeTrack,n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this,i;r.apply(t,arguments);i=t._senders.indexOf(n);i!==-1&&t._senders.splice(i,1)}),u=n.RTCPeerConnection.prototype.addStream,n.RTCPeerConnection.prototype.addStream=function(n){var i=this;i._senders=i._senders||[];u.apply(i,[n]);n.getTracks().forEach(function(n){i._senders.push(t(i,n))})},f=n.RTCPeerConnection.prototype.removeStream,n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;t._senders=t._senders||[];f.apply(t,[n]);n.getTracks().forEach(function(n){var i=t._senders.find(function(t){return t.track===n});i&&t._senders.splice(t._senders.indexOf(i),1)})}):typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&(e=n.RTCPeerConnection.prototype.getSenders,n.RTCPeerConnection.prototype.getSenders=function(){var n=this,t=e.apply(n,[]);return t.forEach(function(t){t._pc=n}),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this._dtmf=this.track.kind==="audio"?this._pc.createDTMFSender(this.track):null),this._dtmf}}))},shimSenderReceiverGetStats:function(n){var t,r,f,e;typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver&&("getStats"in n.RTCRtpSender.prototype||(t=n.RTCPeerConnection.prototype.getSenders,t&&(n.RTCPeerConnection.prototype.getSenders=function(){var n=this,i=t.apply(n,[]);return i.forEach(function(t){t._pc=n}),i}),r=n.RTCPeerConnection.prototype.addTrack,r&&(n.RTCPeerConnection.prototype.addTrack=function(){var n=r.apply(this,arguments);return n._pc=this,n}),n.RTCRtpSender.prototype.getStats=function(){var n=this;return this._pc.getStats().then(function(t){return u(t,n.track,!0)})}),"getStats"in n.RTCRtpReceiver.prototype||(f=n.RTCPeerConnection.prototype.getReceivers,f&&(n.RTCPeerConnection.prototype.getReceivers=function(){var n=this,t=f.apply(n,[]);return t.forEach(function(t){t._pc=n}),t}),i.wrapPeerConnectionEvent(n,"track",function(n){return n.receiver._pc=n.srcElement,n}),n.RTCRtpReceiver.prototype.getStats=function(){var n=this;return this._pc.getStats().then(function(t){return u(t,n.track,!1)})}),"getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype)&&(e=n.RTCPeerConnection.prototype.getStats,n.RTCPeerConnection.prototype.getStats=function(){var u=this,r,t,i,f;return arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack?(r=arguments[0],u.getSenders().forEach(function(n){n.track===r&&(t?f=!0:t=n)}),u.getReceivers().forEach(function(n){return n.track===r&&(i?f=!0:i=n),n.track===r}),f||t&&i)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError")):e.apply(u,arguments)})},shimSourceObject:function(n){var t=n&&n.URL;typeof n=="object"&&(!n.HTMLMediaElement||"srcObject"in n.HTMLMediaElement.prototype||Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(n){var i=this;if(this._srcObject=n,this.src&&t.revokeObjectURL(this.src),!n)return this.src="",undefined;this.src=t.createObjectURL(n);n.addEventListener("addtrack",function(){i.src&&t.revokeObjectURL(i.src);i.src=t.createObjectURL(n)});n.addEventListener("removetrack",function(){i.src&&t.revokeObjectURL(i.src);i.src=t.createObjectURL(n)})}}))},shimAddTrackRemoveTrackWithNative:function(n){var t,i,r,u;n.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return n._shimmedLocalStreams[t][0]})};t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(n,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?this._shimmedLocalStreams[i.id].indexOf(r)===-1&&this._shimmedLocalStreams[i.id].push(r):this._shimmedLocalStreams[i.id]=[i,r],r};i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(n){var t=this,r,u;this._shimmedLocalStreams=this._shimmedLocalStreams||{};n.getTracks().forEach(function(n){var i=t.getSenders().find(function(t){return t.track===n});if(i)throw new DOMException("Track already exists.","InvalidAccessError");});r=t.getSenders();i.apply(this,arguments);u=t.getSenders().filter(function(n){return r.indexOf(n)===-1});this._shimmedLocalStreams[n.id]=[n].concat(u)};r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(n){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[n.id],r.apply(this,arguments)};u=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(function(i){var r=t._shimmedLocalStreams[i].indexOf(n);r!==-1&&t._shimmedLocalStreams[i].splice(r,1);t._shimmedLocalStreams[i].length===1&&delete t._shimmedLocalStreams[i]}),u.apply(this,arguments)}},shimAddTrackRemoveTrack:function(n){function t(n,t){var i=t.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(t){var r=n._reverseStreams[t],u=n._streams[r.id];i=i.replace(new RegExp(u.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:i})}function h(n,t){var i=t.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(t){var r=n._reverseStreams[t],u=n._streams[r.id];i=i.replace(new RegExp(r.id,"g"),u.id)}),new RTCSessionDescription({type:t.type,sdp:i})}var s=i.detectBrowser(n),u,f,e,r,o;if(n.RTCPeerConnection.prototype.addTrack&&s.version>=65)return this.shimAddTrackRemoveTrackWithNative(n);u=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this,t=u.apply(this);return n._reverseStreams=n._reverseStreams||{},t.map(function(t){return n._reverseStreams[t.id]})};f=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(t){var i=this,r;i._streams=i._streams||{};i._reverseStreams=i._reverseStreams||{};t.getTracks().forEach(function(n){var t=i.getSenders().find(function(t){return t.track===n});if(t)throw new DOMException("Track already exists.","InvalidAccessError");});i._reverseStreams[t.id]||(r=new n.MediaStream(t.getTracks()),i._streams[t.id]=r,i._reverseStreams[r.id]=t,t=r);f.apply(i,[t])};e=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};e.apply(t,[t._streams[n.id]||n]);delete t._reverseStreams[t._streams[n.id]?t._streams[n.id].id:n.id];delete t._streams[n.id]};n.RTCPeerConnection.prototype.addTrack=function(t,i){var r=this,f,o,e,u;if(r.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(f=[].slice.call(arguments,1),f.length!==1||!f[0].getTracks().find(function(n){return n===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(o=r.getSenders().find(function(n){return n.track===t}),o)throw new DOMException("Track already exists.","InvalidAccessError");return r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},e=r._streams[i.id],e?(e.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})):(u=new n.MediaStream([t]),r._streams[i.id]=u,r._reverseStreams[u.id]=i,r.addStream(u)),r.getSenders().find(function(n){return n.track===t})};["createOffer","createAnswer"].forEach(function(i){var r=n.RTCPeerConnection.prototype[i];n.RTCPeerConnection.prototype[i]=function(){var n=this,i=arguments,u=arguments.length&&typeof arguments[0]=="function";return u?r.apply(n,[function(r){var u=t(n,r);i[0].apply(null,[u])},function(n){i[1]&&i[1].apply(null,n)},arguments[2]]):r.apply(n,arguments).then(function(i){return t(n,i)})}});r=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){var n=this;return!arguments.length||!arguments[0].type?r.apply(n,arguments):(arguments[0]=h(n,arguments[0]),r.apply(n,arguments))};o=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get:function(){var i=this,n=o.get.apply(this);return n.type===""?n:t(i,n)}});n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this,r,i;if(t.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!n._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(r=n._pc===t,!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};Object.keys(t._streams).forEach(function(r){var u=t._streams[r].getTracks().find(function(t){return n.track===t});u&&(i=t._streams[r])});i&&(i.getTracks().length===1?t.removeStream(t._reverseStreams[i.id]):i.removeTrack(n.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(n){var u=i.detectBrowser(n),r,t,e;!n.RTCPeerConnection&&n.webkitRTCPeerConnection?(n.RTCPeerConnection=function(t,i){return f("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new n.webkitRTCPeerConnection(t,i)},n.RTCPeerConnection.prototype=n.webkitRTCPeerConnection.prototype,n.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.webkitRTCPeerConnection.generateCertificate}})):(r=n.RTCPeerConnection,n.RTCPeerConnection=function(n,t){var e,f,u;if(n&&n.iceServers){for(e=[],f=0;f<n.iceServers.length;f++)u=n.iceServers[f],!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,e.push(u)):e.push(n.iceServers[f]);n.iceServers=e}return new r(n,t)},n.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}}));t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(n,i,r){var o=this,s=arguments,u,f,e;return arguments.length>0&&typeof n=="function"?t.apply(this,arguments):t.length===0&&(arguments.length===0||typeof arguments[0]!="function")?t.apply(this,[]):(u=function(n){var t={},i=n.result();return i.forEach(function(n){var i={id:n.id,timestamp:n.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type};n.names().forEach(function(t){i[t]=n.stat(t)});t[i.id]=i}),t},f=function(n){return new Map(Object.keys(n).map(function(t){return[t,n[t]]}))},arguments.length>=2)?(e=function(n){s[1](f(u(n)))},t.apply(this,[e,arguments[0]])):new Promise(function(n,i){t.apply(o,[function(t){n(f(u(t)))},i])}).then(i,r)};u.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var n=arguments,r=this,t=new Promise(function(t,u){i.apply(r,[n[0],t,u])});return n.length<2?t:t.then(function(){n[1].apply(null,[])},function(t){n.length>=3&&n[2].apply(null,[t])})}});u.version<52&&["createOffer","createAnswer"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var t=this,n;return arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"?(n=arguments.length===1?arguments[0]:undefined,new Promise(function(r,u){i.apply(t,[r,u,n])})):i.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});e=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(n){i.wrapPeerConnectionEvent(n,"negotiationneeded",function(n){var t=n.target;if(t.signalingState==="stable")return n})},shimGetDisplayMedia:function(n,t){if(!("getDisplayMedia"in n.navigator)){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}navigator.getDisplayMedia=function(n){return t(n).then(function(t){return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n.video.frameRate||3}},navigator.mediaDevices.getUserMedia(n)})}}}}},{"../utils.js":14,"./getusermedia":6}],6:[function(n,t){"use strict";var r=n("../utils.js"),i=r.log;t.exports=function(n){var u=r.detectBrowser(n),t=n&&n.navigator,f=function(n){if(typeof n!="object"||n.mandatory||n.optional)return n;var t={};return Object.keys(n).forEach(function(i){var r,f,u;i!=="require"&&i!=="advanced"&&i!=="mediaSource"&&(r=typeof n[i]=="object"?n[i]:{ideal:n[i]},r.exact!==undefined&&typeof r.exact=="number"&&(r.min=r.max=r.exact),f=function(n,t){return n?n+t.charAt(0).toUpperCase()+t.slice(1):t==="deviceId"?"sourceId":t},r.ideal!==undefined&&(t.optional=t.optional||[],u={},typeof r.ideal=="number"?(u[f("min",i)]=r.ideal,t.optional.push(u),u={},u[f("max",i)]=r.ideal,t.optional.push(u)):(u[f("",i)]=r.ideal,t.optional.push(u))),r.exact!==undefined&&typeof r.exact!="number"?(t.mandatory=t.mandatory||{},t.mandatory[f("",i)]=r.exact):["min","max"].forEach(function(n){r[n]!==undefined&&(t.mandatory=t.mandatory||{},t.mandatory[f(n,i)]=r[n])}))}),n.advanced&&(t.optional=(t.optional||[]).concat(n.advanced)),t},o=function(n,r){var s,e,h,o;if(u.version>=61)return r(n);if(n=JSON.parse(JSON.stringify(n)),n&&typeof n.audio=="object"&&(s=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},n=JSON.parse(JSON.stringify(n)),s(n.audio,"autoGainControl","googAutoGainControl"),s(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=f(n.audio)),n&&typeof n.video=="object"){if(e=n.video.facingMode,e=e&&(typeof e=="object"?e:{ideal:e}),h=u.version<66,e&&(e.exact==="user"||e.exact==="environment"||e.ideal==="user"||e.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)&&(delete n.video.facingMode,e.exact==="environment"||e.ideal==="environment"?o=["back","rear"]:(e.exact==="user"||e.ideal==="user")&&(o=["front"]),o))return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(n){return n.kind==="videoinput"});var u=t.find(function(n){return o.some(function(t){return n.label.toLowerCase().indexOf(t)!==-1})});return!u&&t.length&&o.indexOf("back")!==-1&&(u=t[t.length-1]),u&&(n.video.deviceId=e.exact?{exact:u.deviceId}:{ideal:u.deviceId}),n.video=f(n.video),i("chrome: "+JSON.stringify(n)),r(n)});n.video=f(n.video)}return i("chrome: "+JSON.stringify(n)),r(n)},s=function(n){return u.version>=64?n:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[n.name]||n.name,message:n.message,constraint:n.constraint||n.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(n,i,r){o(n,function(n){t.webkitGetUserMedia(n,i,function(n){r&&r(s(n))})})},e,h;t.getUserMedia=c;e=function(n){return new Promise(function(i,r){t.getUserMedia(n,i,r)})};t.mediaDevices||(t.mediaDevices={getUserMedia:e,enumerateDevices:function(){return new Promise(function(t){var i={audio:"audioinput",video:"videoinput"};return n.MediaStreamTrack.getSources(function(n){t(n.map(function(n){return{label:n.label,kind:i[n.kind],deviceId:n.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});t.mediaDevices.getUserMedia?(h=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return o(n,function(n){return h(n).then(function(t){if(n.audio&&!t.getAudioTracks().length||n.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(n){n.stop()});throw new DOMException("","NotFoundError");}return t},function(n){return Promise.reject(s(n))})})}):t.mediaDevices.getUserMedia=function(n){return e(n)};typeof t.mediaDevices.addEventListener=="undefined"&&(t.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")});typeof t.mediaDevices.removeEventListener=="undefined"&&(t.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(n,t){"use strict";var i=n("sdp"),r=n("./utils");t.exports={shimRTCIceCandidate:function(n){if(n.RTCIceCandidate&&(!n.RTCIceCandidate||!("foundation"in n.RTCIceCandidate.prototype))){var t=n.RTCIceCandidate;n.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){var u=new t(n),f=i.parseCandidate(n.candidate),r=Object.assign(u,f);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(n)};n.RTCIceCandidate.prototype=t.prototype;r.wrapPeerConnectionEvent(n,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(n){var t=n&&n.URL,u,f;if(!(typeof n=="object"&&n.HTMLMediaElement&&"srcObject"in n.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL))return undefined;var e=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),i=new Map,s=0;t.createObjectURL=function(n){if("getTracks"in n){var t="polyblob:"+ ++s;return i.set(t,n),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return e(n)};t.revokeObjectURL=function(n){o(n);i.delete(n)};u=Object.getOwnPropertyDescriptor(n.HTMLMediaElement.prototype,"src");Object.defineProperty(n.HTMLMediaElement.prototype,"src",{get:function(){return u.get.apply(this)},set:function(n){return this.srcObject=i.get(n)||null,u.set.apply(this,[n])}});f=n.HTMLMediaElement.prototype.setAttribute;n.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=i.get(arguments[1])||null),f.apply(this,arguments)}},shimMaxMessageSize:function(n){var t;if(!n.RTCSctpTransport&&n.RTCPeerConnection){t=r.detectBrowser(n);"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp=="undefined"?null:this._sctp}});var u=function(n){var t=i.splitSections(n.sdp);return t.shift(),t.some(function(n){var t=i.parseMLine(n);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},f=function(n){var i=n.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),t;return i===null||i.length<2?-1:(t=parseInt(i[1],10),t!==t?-1:t)},e=function(n){var i=65536;return t.browser==="firefox"&&(i=t.version<57?n===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),i},o=function(n,r){var u=65536,f;return t.browser==="firefox"&&t.version===57&&(u=65535),f=i.matchPrefix(n.sdp,"a=max-message-size:"),f.length>0?u=parseInt(f[0].substr(19),10):t.browser==="firefox"&&r!==-1&&(u=2147483637),u},s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this,r;if(i._sctp=null,u(arguments[0])){var h=f(arguments[0]),n=e(h),t=o(arguments[0],h),c;c=n===0&&t===0?Number.POSITIVE_INFINITY:n===0||t===0?Math.max(n,t):Math.min(n,t);r={};Object.defineProperty(r,"maxMessageSize",{get:function(){return c}});i._sctp=r}return s.apply(i,arguments)}}},shimSendThrowTypeError:function(n){function t(n,t){var i=n.send;n.send=function(){var r=arguments[0],u=r.length||r.size||r.byteLength;if(n.readyState==="open"&&t.sctp&&u>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}if(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype){var i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){var n=this,r=i.apply(n,arguments);return t(r,n),r};r.wrapPeerConnectionEvent(n,"datachannel",function(n){return t(n.channel,n.target),n})}}}},{"./utils":14,sdp:2}],8:[function(n,t){"use strict";var i=n("../utils"),r=n("./filtericeservers"),u=n("rtcpeerconnection-shim");t.exports={shimGetUserMedia:n("./getusermedia"),shimPeerConnection:function(n){var f=i.detectBrowser(n),e,t;n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(n){return n}),n.RTCSessionDescription||(n.RTCSessionDescription=function(n){return n}),f.version<15025&&(e=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set:function(n){e.set.call(this,n);var t=new Event("enabled");t.enabled=n;this.dispatchEvent(t)}})));!n.RTCRtpSender||"dtmf"in n.RTCRtpSender.prototype||Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}});n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);t=u(n,f.version);n.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=r(n.iceServers)),new t(n)};n.RTCPeerConnection.prototype=t.prototype},shimReplaceTrack:function(n){!n.RTCRtpSender||"replaceTrack"in n.RTCRtpSender.prototype||(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(n,t){"use strict";var i=n("../utils");t.exports=function(n,t){var r=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(n){var u,f;if(n&&(n.urls||n.url))return u=n.urls||n.url,n.url&&!n.urls&&i.deprecated("RTCIceServer.url","RTCIceServer.urls"),f=typeof u=="string",f&&(u=[u]),u=u.filter(function(n){var i=n.indexOf("turn:")===0&&n.indexOf("transport=udp")!==-1&&n.indexOf("turn:[")===-1&&!r;return i?(r=!0,!0):n.indexOf("stun:")===0&&t>=14393&&n.indexOf("?transport=udp")===-1}),delete n.url,n.urls=f?u[0]:u,!!u.length})}},{"../utils":14}],10:[function(n,t){"use strict";t.exports=function(n){var t=n&&n.navigator,i=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(n){return r(n).catch(function(n){return Promise.reject(i(n))})}}},{}],11:[function(n,t){"use strict";var i=n("../utils");t.exports={shimGetUserMedia:n("./getusermedia"),shimOnTrack:function(n){typeof n!="object"||!n.RTCPeerConnection||"ontrack"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=n);this.addEventListener("addstream",this._ontrackpoly=function(n){n.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t;i.receiver={track:t};i.transceiver={receiver:i.receiver};i.streams=[n.stream];this.dispatchEvent(i)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0});typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(n){typeof n=="object"&&(!n.HTMLMediaElement||"srcObject"in n.HTMLMediaElement.prototype||Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(n){this.mozSrcObject=n}}))},shimPeerConnection:function(n){var t=i.detectBrowser(n),r;if(typeof n=="object"&&(n.RTCPeerConnection||n.mozRTCPeerConnection)){n.RTCPeerConnection||(n.RTCPeerConnection=function(i,r){var o,f,u,e,s;if(t.version<38&&i&&i.iceServers){for(o=[],f=0;f<i.iceServers.length;f++)if(u=i.iceServers[f],u.hasOwnProperty("urls"))for(e=0;e<u.urls.length;e++)s={url:u.urls[e]},u.urls[e].indexOf("turn")===0&&(s.username=u.username,s.credential=u.credential),o.push(s);else o.push(i.iceServers[f]);i.iceServers=o}return new n.mozRTCPeerConnection(i,r)},n.RTCPeerConnection.prototype=n.mozRTCPeerConnection.prototype,n.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.mozRTCPeerConnection.generateCertificate}}),n.RTCSessionDescription=n.mozRTCSessionDescription,n.RTCIceCandidate=n.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}});r=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var f=function(n){var t=new Map;return Object.keys(n).forEach(function(i){t.set(i,n[i]);t[i]=n[i]}),t},u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(n,i,r){return e.apply(this,[n||null]).then(function(n){if(t.version<48&&(n=f(n)),t.version<53&&!i)try{n.forEach(function(n){n.type=u[n.type]||n.type})}catch(r){if(r.name!=="TypeError")throw r;n.forEach(function(t,i){n.set(i,Object.assign({},t,{type:u[t.type]||t.type}))})}return n}).then(i,r)}}},shimSenderGetStats:function(n){var t,i;typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype||(t=n.RTCPeerConnection.prototype.getSenders,t&&(n.RTCPeerConnection.prototype.getSenders=function(){var n=this,i=t.apply(n,[]);return i.forEach(function(t){t._pc=n}),i}),i=n.RTCPeerConnection.prototype.addTrack,i&&(n.RTCPeerConnection.prototype.addTrack=function(){var n=i.apply(this,arguments);return n._pc=this,n}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}))},shimReceiverGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpReceiver.prototype))){var t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){var n=this,i=t.apply(n,[]);return i.forEach(function(t){t._pc=n}),i});i.wrapPeerConnectionEvent(n,"track",function(n){return n.receiver._pc=n.srcElement,n});n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;i.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(i){i.track&&n.getTracks().indexOf(i.track)!==-1&&t.removeTrack(i)})})},shimRTCDataChannel:function(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)},shimGetDisplayMedia:function(n,t){"getDisplayMedia"in n.navigator||(navigator.getDisplayMedia=function(n){if(!(n&&n.video)){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,navigator.mediaDevices.getUserMedia(n)})}}},{"../utils":14,"./getusermedia":12}],12:[function(n,t){"use strict";var i=n("../utils"),r=i.log;t.exports=function(n){var e=i.detectBrowser(n),t=n&&n.navigator,u=n&&n.MediaStreamTrack,o=function(n){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[n.name]||n.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[n.message]||n.message,constraint:n.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(n,i,u){var f=function(n){if(typeof n!="object"||n.require)return n;var t=[];return Object.keys(n).forEach(function(i){var r,u;i!=="require"&&i!=="advanced"&&i!=="mediaSource"&&(r=n[i]=typeof n[i]=="object"?n[i]:{ideal:n[i]},(r.min!==undefined||r.max!==undefined||r.exact!==undefined)&&t.push(i),r.exact!==undefined&&(typeof r.exact=="number"?r.min=r.max=r.exact:n[i]=r.exact,delete r.exact),r.ideal!==undefined&&(n.advanced=n.advanced||[],u={},u[i]=typeof r.ideal=="number"?{min:r.ideal,max:r.ideal}:r.ideal,n.advanced.push(u),delete r.ideal,Object.keys(r).length||delete n[i]))}),t.length&&(n.require=t),n};return n=JSON.parse(JSON.stringify(n)),e.version<38&&(r("spec: "+JSON.stringify(n)),n.audio&&(n.audio=f(n.audio)),n.video&&(n.video=f(n.video)),r("ff37: "+JSON.stringify(n))),t.mozGetUserMedia(n,i,function(n){u(o(n))})},y=function(n){return new Promise(function(t,i){s(n,t,i)})},h,c,f,l,a,v;t.mediaDevices||(t.mediaDevices={getUserMedia:y,addEventListener:function(){},removeEventListener:function(){}});t.mediaDevices.enumerateDevices=t.mediaDevices.enumerateDevices||function(){return new Promise(function(n){n([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};e.version<41&&(h=t.mediaDevices.enumerateDevices.bind(t.mediaDevices),t.mediaDevices.enumerateDevices=function(){return h().then(undefined,function(n){if(n.name==="NotFoundError")return[];throw n;})});e.version<49&&(c=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return c(n).then(function(t){if(n.audio&&!t.getAudioTracks().length||n.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(n){n.stop()});throw new DOMException("The object can not be found here.","NotFoundError");}return t},function(n){return Promise.reject(o(n))})});e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints()||(f=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},l=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return typeof n=="object"&&typeof n.audio=="object"&&(n=JSON.parse(JSON.stringify(n)),f(n.audio,"autoGainControl","mozAutoGainControl"),f(n.audio,"noiseSuppression","mozNoiseSuppression")),l(n)},u&&u.prototype.getSettings&&(a=u.prototype.getSettings,u.prototype.getSettings=function(){var n=a.apply(this,arguments);return f(n,"mozAutoGainControl","autoGainControl"),f(n,"mozNoiseSuppression","noiseSuppression"),n}),u&&u.prototype.applyConstraints&&(v=u.prototype.applyConstraints,u.prototype.applyConstraints=function(n){return this.kind==="audio"&&typeof n=="object"&&(n=JSON.parse(JSON.stringify(n)),f(n,"autoGainControl","mozAutoGainControl"),f(n,"noiseSuppression","mozNoiseSuppression")),v.apply(this,[n])}));t.getUserMedia=function(n,r,u){if(e.version<44)return s(n,r,u);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");t.mediaDevices.getUserMedia(n).then(r,u)}}},{"../utils":14}],13:[function(n,t){"use strict";var i=n("../utils");t.exports={shimLocalStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getStreamById=function(n){var t=null;return this._localStreams&&this._localStreams.forEach(function(i){i.id===n&&(t=i)}),this._remoteStreams&&this._remoteStreams.forEach(function(i){i.id===n&&(t=i)}),t}),!("addStream"in n.RTCPeerConnection.prototype)){var t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]);this._localStreams.indexOf(n)===-1&&this._localStreams.push(n);var i=this;n.getTracks().forEach(function(r){t.call(i,r,n)})};n.RTCPeerConnection.prototype.addTrack=function(n,i){return i&&(this._localStreams?this._localStreams.indexOf(i)===-1&&this._localStreams.push(i):this._localStreams=[i]),t.call(this,n,i)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(n){var t,i,r;(this._localStreams||(this._localStreams=[]),t=this._localStreams.indexOf(n),t!==-1)&&(this._localStreams.splice(t,1),i=this,r=n.getTracks(),this.getSenders().forEach(function(n){r.indexOf(n.track)!==-1&&i.removeTrack(n)}))})}},shimRemoteStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(n){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream);this.addEventListener("addstream",this._onaddstream=n)}});var t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(n._remoteStreams||(n._remoteStreams=[]),!(n._remoteStreams.indexOf(t)>=0)){n._remoteStreams.push(t);var i=new Event("addstream");i.stream=t;n.dispatchEvent(i)}})}),t.apply(n,arguments)}}},shimCallbacksAPI:function(n){var i;if(typeof n=="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype,r=t.createOffer,u=t.createAnswer,f=t.setLocalDescription,e=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(n,t){var u=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[u]);return t?(i.then(n,t),Promise.resolve()):i};t.createAnswer=function(n,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=u.apply(this,[r]);return t?(i.then(n,t),Promise.resolve()):i};i=function(n,t,i){var r=f.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=i;i=function(n,t,i){var r=e.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setRemoteDescription=i;i=function(n,t,i){var r=o.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.addIceCandidate=i}},shimGetUserMedia:function(n){var t=n&&n.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}.bind(t)))},shimRTCIceServerUrls:function(n){var t=n.RTCPeerConnection;n.RTCPeerConnection=function(n,r){var e,f,u;if(n&&n.iceServers){for(e=[],f=0;f<n.iceServers.length;f++)u=n.iceServers[f],!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,e.push(u)):e.push(n.iceServers[f]);n.iceServers=e}return new t(n,r)};n.RTCPeerConnection.prototype=t.prototype;"generateCertificate"in n.RTCPeerConnection&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(n){typeof n=="object"&&n.RTCPeerConnection&&"receiver"in n.RTCTrackEvent.prototype&&!n.RTCTransceiver&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(n){var t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(n){var u=this,i,r;return n&&(typeof n.offerToReceiveAudio!="undefined"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio),i=u.getTransceivers().find(function(n){return n.sender.track&&n.sender.track.kind==="audio"}),n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||u.addTransceiver("audio"),typeof n.offerToReceiveVideo!="undefined"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo),r=u.getTransceivers().find(function(n){return n.sender.track&&n.sender.track.kind==="video"}),n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection("sendonly"):r.direction==="recvonly"&&r.setDirection("inactive"):n.offerToReceiveVideo!==!0||r||u.addTransceiver("video")),t.apply(u,arguments)}}}},{"../utils":14}],14:[function(n,t){"use strict";function i(n,t,i){var r=n.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function f(n,t,i){var r,u,f;n.RTCPeerConnection&&(r=n.RTCPeerConnection.prototype,u=r.addEventListener,r.addEventListener=function(n,r){if(n!==t)return u.apply(this,arguments);var f=function(n){var t=i(n);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=f,u.apply(this,[n,f])},f=r.removeEventListener,r.removeEventListener=function(n,i){if(n!==t||!this._eventMap||!this._eventMap[i])return f.apply(this,arguments);var r=this._eventMap[i];return delete this._eventMap[i],f.apply(this,[n,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(n){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]);n&&this.addEventListener(t,this["_on"+t]=n)},enumerable:!0,configurable:!0}))}var r=!0,u=!0;t.exports={extractVersion:i,wrapPeerConnectionEvent:f,disableLog:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(r=n,n?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(u=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(r)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(n,t){u&&console.warn(n+" is deprecated, please use "+t+" instead.")},detectBrowser:function(n){var r=n&&n.navigator,t={};if(t.browser=null,t.version=null,typeof n=="undefined"||!n.navigator)return t.browser="Not a browser.",t;if(r.mozGetUserMedia)t.browser="firefox",t.version=i(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia)t.browser="chrome",t.version=i(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=i(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=i(r.userAgent,/AppleWebKit\/(\d+)\./,1);else return t.browser="Not a supported browser.",t;return t}}},{}]},{},[3])(3)});