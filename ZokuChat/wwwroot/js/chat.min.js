class Room{constructor(n,t,i){this.id=n;this.creatorId=t;this.currentUserId=i}}class Error{constructor(n,t){this.caption=n;this.message=t}}class Broadcast{constructor(n){this.streamUrl=n}}window.ZokuChat.chat={};window.ZokuChat.chat.room=null;var app=new Vue({el:"#chat-app",data:{window:window,connection:(new signalR.HubConnectionBuilder).withUrl("/chatHub").build(),peerConnection:new RTCPeerConnection({iceServers:[{urls:"stun:stun.1.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.1.google.com:19302"},{urls:"stun:stun4.1.google.com:19302"},{urls:"stun:stun01.sipphone.com"},{urls:"stun:stun.ekiga.net"},{urls:"stun:stun.fwdnet.net"},{urls:"stun:stun.ideasip.com"},{urls:"stun:stun.iptel.org"},{urls:"stun:stun.rixtelecom.se"},{urls:"stun:stun.schlund.de"},{urls:"stun:stunserver.org"},{urls:"stun:stun.softjoys.com"},{urls:"stun:stun.voiparound.com"},{urls:"stun:stun.voipbuster.com"},{urls:"stun:stun.voipstunt.com"},{urls:"stun:stun.voxgratia.org"},{urls:"stun:stun.xten.com"}]}),contacts:[],messages:[],broadcasts:[],errors:[]},methods:{init:()=>{app.connection.on("ReceiveMessages",function(n){n.forEach(function(n){app.messages.push(n)})});app.connection.on("ReceiveContacts",function(n){n.forEach(function(n){app.contacts.push(n)})});app.connection.on("ReceiveMessage",function(n){app.messages.push(n)});app.connection.on("ReceiveDeleteMessage",function(n){let t=app.messages.findIndex(function(t){return t.id===n.id});t>-1&&app.messages.splice(t,1,n)});app.connection.on("ReceiveBroadcast",function(n){app.broadcasts.push(n)});app.connection.on("ReceiveDeleteBroadcast",function(n){let i=$(`#broadcast-${n.userId}`).getTracks();i.forEach(function(n){n.stop()});let t=app.broadcasts.findIndex(function(t){return t.userId===n.userId});t>-1&&app.broadcasts.splice(t,1)});app.connection.on("ReceiveError",function(n,t){app.errors.push(n,t)});app.connection.start().catch(function(n){return console.error(n.toString())}).then(function(){app.joinRoom().then(function(){app.retrieveMessages()})});app.peerConnection.ontrack=function(){};app.peerConnection.onicecandidate=function(n){n.candidate&&app.sendCandidate(n.candidate)};app.connection.on("ReceiveOffer",function(n){app.peerConnection.setRemoteDescription(new RTCSessionDescription(n));app.peerConnection.createAnswer(function(n){app.peerConnection.setLocalDescription(n);app.sendAnswer(n)})});app.connection.on("ReceiveAnswer",function(n){app.peerConnection.setRemoteDescription(new RTCSessionDescription(n))});app.connection.on("ReceiveCandidate",function(n){app.peerConnection.addIceCandidate(new RTCIceCandidate(n))})},joinRoom:()=>app.connection.invoke("JoinRoom",window.ZokuChat.chat.room.id).catch(function(n){return console.error(n.toString())}),retrieveMessages:()=>app.connection.invoke("GetMessages",window.ZokuChat.chat.room.id).catch(function(n){return console.error(n.toString())}),sendMessage:n=>app.connection.invoke("SendMessage",window.ZokuChat.chat.room.id,n).catch(function(n){return console.error(n.toString())}),sendButtonClick:()=>{$("#message-input").val().length>0&&(app.sendMessage($("#message-input").val()),$("#message-input").val(""))},sendAnswer:n=>app.connection.invoke("SendAnswer",window.ZokuChat.chat.room.id,JSON.stringify(n)).catch(function(n){return console.error(n.toString())}),sendCandidate:n=>app.connection.invoke("SendCandidate",window.ZokuChat.chat.room.id,JSON.stringify(n)).catch(function(n){return console.error(n.toString())}),deleteMessage:n=>app.connection.invoke("DeleteMessage",window.ZokuChat.chat.room.id,n.id).catch(function(n){return console.error(n.toString())}),canDeleteMessage:n=>{let t=window.ZokuChat.chat.room.currentUserId;return t===n.userId||t===window.ZokuChat.chat.room.creatorId},startBroadcast:()=>{let n;return navigator.getUserMedia({video:!0,audio:!0},function(t){n=new Broadcast(window.URL.createObjectURL(t));app.peerConnection.addStream(t)}),n?app.connection.invoke("StartBroadcast",window.ZokuChat.chat.room.id,n).catch(function(n){return console.error(n.toString())}):void 0},stopBroadcast:()=>app.connection.invoke("StopBroadcast",window.ZokuChat.chat.room.id).catch(function(n){return console.error(n.toString())})}});